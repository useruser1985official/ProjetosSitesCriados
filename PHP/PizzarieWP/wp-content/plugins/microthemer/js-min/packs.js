jQuery(document).ready((function(e){var a=window.parent.TvrMT,t=a.TvrUi,o=a.TvrCom,n=(a.tvrsprintf,window.parent.TvrLang);t.templates=a.data.templates;var r={init:function(){a.data.prog.combo.packTypes=[n.theme_skin,n.plugin_skin,n.theme_scaffold,n.plugin_scaffold],this.jQueryVersion=o.getJQueryVersion(e.fn.jquery),this.jQueryUIVersion=o.getJQueryVersion(e.ui.version,!0),this.autocompleteUsesDivs=this.jQueryUIVersion>="01.12.01",this.autocompleteUsesDivs?e("#tvr").addClass("autocompleteUsesDivs"):e("#tvr").addClass("autocompleteNoDivs"),a&&o.isDomEl(e("#update-packs-list"))&&t.update_packs_obj(e("#update-packs-list").attr("rel")),e("input.combobox").on("focus",(function(){var t=e(this);t.autocomplete({source:a.data.prog.combo[t.attr("rel")],delay:0,minLength:0,appendTo:t.parent(".tvr-input-wrap"),open:function(e,a){t.next(".combo-arrow").addClass("on")},select:function(e,a){if(t.val(a.item.value),t.closest(".tvr-input-wrap").addClass("manual-val").find(".comp-style").addClass("hidden").end().find(".combo-arrow").removeClass("on"),"css_unit_set"===t.attr("id")){var o=t.val();t.closest("ul").find("input.custom_css_unit").val(o)}},search:function(e,a){t.addClass("adjusted-corner-radius")},close:function(e,a){t.removeClass("adjusted-corner-radius").next(".combo-arrow").removeClass("on")}})})),e("span.combo-arrow").on("mousedown",(function(){e(this).siblings(".ui-menu").is(":visible")&&(r.wasOpen=!0)})),e("span.combo-arrow").on("click",(function(){var a=e(this),t=a.prev();if(r.wasOpen)return a.removeClass("on"),void(r.wasOpen=!1);a.addClass("on"),t.focus().autocomplete("search","")})),e("#tvr").on("click",(function(a){var o=e(a.target);try{if(!(i=o.attr("class")))var i="tvr-undefined"}catch(e){}if(i.indexOf("pack-action")>=0||i.indexOf("pack-icon")>=0||i.indexOf("action-text")>=0){var s=o.closest(".pack-action");r.pack_button_action(s)}else i.indexOf("delete-pack-multi")>=0?r.delete_pack(o,"multi"):i.indexOf("download-pack-multi")>=0?r.download_pack(o,"multi"):i.indexOf("combobox")>=0?r.combobox_clicked(o):i.indexOf("delete-file")>=0?r.delete_file(o,a):i.indexOf("show-parent-dialog")>=0?(t.show_dialog(o),"import-from-pack"==o.attr("rel")&&t.set_import_field(o.data("pack-name"))):i.indexOf("close-dialog")>=0||i.indexOf("tvr-dialog")>=0?r.close_dialog(o):i.indexOf("fake-checkbox")>=0||i.indexOf("fake-radio")>=0?r.toggle_radio_checkbox(o):i.indexOf("upload-pack")>=0?e("#upload_pack_input").val()||(alert(n.select_zip),a.preventDefault()):i.indexOf("dialog-tab")>=0&&i.indexOf("dialog-tabs")<0&&i.indexOf("dialog-tab-field")<0?r.dialog_tab_pressed(o):i.indexOf("reveal-hidden-form-opts")>=0?r.reveal_form_opts(o):i.indexOf("save-preferences")>=0&&r.save_preferences(o)}))},escape_backslashes:function(e,a){return a?e.replace(/%5C/g,"%26%2392%3B"):e.replace(/\\/g,"&#92;")},save_preferences:function(a){var t=e("#ajaxUrl").attr("rel"),o=e("#returnUrl").attr("rel"),i=n.saving_preferences,s=r.escape_backslashes(e("#tvr-preferences").serialize(),!0);r.general_ajax_submission("Preferences save",t,o,i,"POST",s,a)},general_ajax_submission:function(a,o,n,i,s,l,d){e.ajax({type:s,url:o,data:l,timeout:t.tOut,error:function(a,t){e("img.ajax-loader").remove(),alert(r.handle_ajax_error(a,t))},success:function(e){window.location=n}})},reveal_form_opts:function(e){var a=e.attr("rel");e.closest("li").siblings(".hidden."+a).addClass("show")},dialog_tab_pressed:function(e){var a=e.closest(".dialog-main"),t=a.find(".dialog-tabs"),o=e.attr("rel");r.update_tab(a,".dialog-tab-field",t,o,".dialog-tab",".dummy-for-now")},update_tab:function(e,a,t,o,n,r,i){t.find(n).removeClass("active").end().find(n+"-"+o).addClass("active").end().find(r).val(o),i||e.find(a+".show").removeClass("show").end().find(a+"-"+o).addClass("show")},combobox_clicked:function(e){e.autocomplete("search","").next(".combo-arrow").addClass("on")},pack_button_action:function(a){var t=a.attr("rel");if("info"==t||"attachments"==t||"instructions"==t){e("#main-theme-actions").find(".pack-action").removeClass("on"),e("#single-content-areas").find(".manage-content-wrap").removeClass("show");e("#main-theme-actions").find("li.pack-action-"+t).addClass("on"),e("#edit-"+t).addClass("show")}else"download"==t?r.download_pack(a,"single"):"delete"==t&&r.delete_pack(a,"single")},download_pack:function(a,o){var i=e("#zip-folder").attr("rel"),s=a.attr("data-dir-name"),l=i+s+".zip",d=e("#ajaxUrl").attr("rel")+"&mt_action=tvr_download_pack&dir_name="+s;e.ajax({type:"GET",url:d,async:!0,timeout:2e4,error:function(a,o){var i=e(t.templates.log_item).removeAttr("id");i.find(".short").text("Download failed").end().find(".long").html("<p>"+t.appName+" "+n.download_failed+"</p><p>"+r.handle_ajax_error(a,o)+"</p>"),e("#full-logs").html('<ul class="logs"></ul>').find("ul").append(i).focus()},success:function(a){var t=e(a).find("#microthemer-notice");"1"===e(a).find("#download-status").attr("rel")?location.href=l:e("#full-logs").html(t.html()).focus()},complete:function(){e("#loading-gif-active").remove()}})},delete_pack:function(o,i){if(!confirm(n.delete_pack_confirm))return!1;var s=o.attr("data-dir-name"),l=o.attr("data-dir-label"),d=e("#ajaxUrl").attr("rel")+"&mt_action=tvr_delete_micro_theme&dir_name="+s,c=e("#delete-ok").attr("rel");e.ajax({type:"GET",url:d,async:!0,timeout:2e4,error:function(a,o){var i=e(t.templates.log_item).removeAttr("id");i.find(".short").text("Delete failed").end().find(".long").html("<p>"+t.appName+" "+n.delete_pack_failed+"</p><p>"+r.handle_ajax_error(a,o)+"</p>"),e("#full-logs").html('<ul class="logs"></ul>').find("ul").append(i).focus(),e("#loading-gif-active").remove()},success:function(t){var n=e(t).find("#microthemer-notice");if("1"===e(t).find("#delete-status").attr("rel")){var r=a.data.prog.combo.directories.indexOf(l);if(-1!==r&&a.data.prog.combo.directories.splice(r,1),"single"==i)window.location=c;else{e("#loading-gif-active").remove(),o.closest("li").fadeOut("slow");var d=e("li.last-modified");d.attr("rel")==s&&d.remove()}}else e("#full-logs").html(n.html()).focus()},complete:function(){}})},handle_ajax_error:function(e,a){return 0==e.status?n.error_connection:404==e.status?n.error_404:500==e.status?n.error_500:"parsererror"==a?n.error_parser:"timeout"==a?n.error_timeout:n.error_unknown+"\n"+e.responseText},export_zip_button:function(a,t){"warn"==e("span#external-notice").text()&&(confirm(n.external_notice)||t.preventDefault())},delete_file:function(e,a){confirm(n.delete_file_confirm)&&(window.location=e.attr("data-href"))},show_dialog:function(e){r.close_dialog()},close_dialog:function(){e("#tvr").find("div.tvr-dialog").removeClass("show")},toggle_radio_checkbox:function(e){var a=e.prev();if(a.is(":checked")){if(e.hasClass("fake-radio"))return!1;a.prop("checked",!1),e.removeClass("on")}else e.hasClass("fake-radio")&&e.closest(".fake-radio-parent").find('input[type="radio"]').prop("checked",!1).end().find(".fake-radio").removeClass("on"),a.prop("checked",!0),e.addClass("on")}};r.init(),e("#tvr-preferences").on("click",(function(a){var t=e(a.target);try{t.attr("class")}catch(e){}}));var i={init:function(){e("#tvr-docs").on("click",(function(a){var t=e(a.target);try{if(!(o=t.attr("class")))var o="tvr-undefined"}catch(e){}(o.indexOf("css-group-heading")>=0||o.indexOf("accordion-menu-arrow")>=0||o.indexOf("pg-icon")>=0||o.indexOf("text-for-group")>=0)&&(t=t.closest(".css-group-heading"),i.update_accordion(t,e("#tvr-docs")))}))},update_accordion:function(e,a){a.find("li.accordion-item");var t=e.parent();if(t.hasClass("show-content"))var o=!0;return a.find(".accordion-menu-arrow.on").removeClass("on"),a.find(".show-content").removeClass("show-content"),o||(t.find(".accordion-menu-arrow").addClass("on"),t.addClass("show-content")),!1}};i.init()}));