<!DOCTYPE html>
<html lang="pt-br">
    <head>
        <meta charset="UTF-8"/>
        <link rel="icon" href="_imagens/favicon.ico"/>
        <title>Aprenda Linux</title>
        <link rel="stylesheet" href="_css/estilo.css"/>
    </head>
    <body>
        <div>
            <header>
                <h1>Aprenda Linux</h1>
                <menu>
                    <li><a href="index.html">Página Inicial</a></li>
                    <li><a href="contato.html">Contato!</a></li>
                    <li><a href="tudo-sobre-linux-1.html">Tudo sobre Linux Parte 1!</a></li>
                    <li><a href="tudo-sobre-linux-2.html">Tudo sobre Linux Parte 2!</a></li>
                    <li><a href="tudo-sobre-linux-3.html">Tudo sobre Linux Parte 3!</a></li>
                    <li><a href="tudo-sobre-linux-4.html" onclick="alert('Você já Está na Matéria desse Link!'); return false">Tudo sobre Linux Parte 4!</a></li>
                    <li><a href="tudo-sobre-linux-5.html">Tudo sobre Linux Parte 5!</a></li>
                    <li><a href="tudo-sobre-linux-6.html">Tudo sobre Linux Parte 6!</a></li>
                </menu>
            </header>
            
<h2>Tudo sobre Linux Parte 4</h2>

<h3>Comandos Básicos - tail, tac e wc</h3>

<p>O comando <code>tail</code> é usado para ver as últimas linhas de um arquivo. Por exemplo:</p>

<pre>
<code>
tail frutas.txt # Mostra as 10 últimas linhas de arq1

tail -n 20 frutas.txt # Mostra as 20 últimas linhas de arq1

tail -n 2 /etc/passwd # Mostra as 2 últimas linhas do arquivo

tail -f /etc/passwd # Mostra as 10 últimas linhas dinamicamente, enquanto são geradas.
</code>
</pre>

<p>O comando <code>tac</code> é o inverso do comando cat: Ele envia os arquivos de texto para a saída padrão, com as linhas em ordem reversa. Basta usar o comando <code>tac frutas.txt</code>.</p>

<p>O comando <code>wc</code> exibe contagem de caracteres, palavras e linhas em arquivos, com as opções <code>-c</code> (contagem de caracteres), <code>-l</code> (contagem de linhas)<code>-w</code> (contagem de palavras). Por exemplo:</p>

<pre>
<code>
wc -l frutas.txt

wc -w frutas.txt

wc -c frutas.txt

wc -l /etc/group
</code>
</pre>

<h3>Comandos Básicos - uniq (Eliminar Linhas Repetidas Adjacentes)</h3>

<p>O comando <code>uniq</code> escreve em stdout uma entrada, eliminando linhas duplicadas adjacentes. A opção <code>-d</code> processa apenas as linhas que se repetem, enquanto a opção <code>-u</code> processa apenas as linhas que não se repetem.</p>

<p>Para eliminar linhas duplicadas não-adjacentes, primeiro organize o arquivo com sort.</p>

<p>Primeiro baixe um arquivo de texto <a href="_files/vegetais.txt" target="_blank" download="vegetais.txt">clicando aqui</a>, depois digite esses comandos:</p>

<pre>
<code>
cat vegetais.txt

uniq vegetais.txt
</code>
</pre>

<p>Pode ver que ele eliminou todas as repetições, exibindo todas as linhas apenas uma vez.</p>

<p>Digite isso:</p>

<pre>
<code>
uniq -d vegetais.txt # Visualiza apenas as linhas que se repetem

uniq -u vegetais.txt # Visualiza apenas as linhas que não se repetem
</code>
</pre>

<h3>Comandos Básicos - cp (Copiar Arquivos) e rm (Remover Arquivos)</h3>

<p>O comando <code>cp</code> copia um arquivo ou diretório para outro local, como por exemplo:</p>

<pre>
<code>
cp /home/user/arq1 /home/eu/arq1
</code>
</pre>

<p>As opções disponíveis para esse comando são:</p>

<ul>
    <li><code>-i</code>: Pede confirmação interativamente.</li>
    <li><code>-r</code>: Copia diretórios recursivamente.</li>
    <li><code>-p</code>: Preserva todas as informações.</li>
</ul>

<p>O comando <code>rm</code> pode ser usado para excluir tanto arquivos como diretórios.</p>

<p>Para excluir arquivos ou diretórios vazios:</p>

<pre>
<code>
rm arquivooudiretorio
</code>
</pre>

<p>Para excluir ou diretórios ocupados:</p>

<pre>
<code>
rm -r diretorio
</code>
</pre>

<h3>Comandos Básicos - mv (Mover Arquivos), cp e rm (Outras Opções)</h3>

<p>Outras opções do comando cp são essas:</p>

<pre>
<code>
cp /home/eu/arq2 . # Copia o arquivo arq2 do diretório home do usuário para o diretório atual

cp /root/a* /home # Copia todos os arquivos que se iniciam com a letra a do diretório root para o home
</code>
</pre>

<p>O comando <code>mv</code> move o arquivo ou diretório para o destino especificado.</p>

<p>As opções disponíveis para esse comando são:</p>

<ul>
    <li><code>-i</code>: Pede confirmação interativamente.</li>
</ul>

<p>Veja um exemplo:</p>

<pre>
<code>
mv /root/arq1 /home # Move o arquivo arq1 de /root para /home
</code>
</pre>

<p>Outro uso para o comando mv é o de renomear arquivos e diretórios, como por exemplo:</p>

<pre>
<code>
mv /home/eu/arq1 /home/eu/arq2
</code>
</pre>

<h3>Comandos Básicos - mkdir, rmdir, rm -rf - Manipulação de Diretórios</h3>

<p>O comando <code>mkdir</code> cria um ou mais diretórios, como por exemplo:</p>

<pre>
<code>
mkdir nomedodiretorio
</code>
</pre>

<p>As opções disponíveis para esse comando são:</p>

<ul>
    <li><code>-m</code>: Define direitos de acesso no modo octal.</li>
    <li><code>-p</code>: Cria subdiretórios recursivamente.</li>
</ul>

<p>O comando <code>rmdir</code> remove um diretório vazio. Usamos ele assim:</p>

<pre>
<code>
rmdir nomedodiretorio
</code>
</pre>

<p>Como visto anteriormente, o comando rm pode ser usado para excluir tanto arquivos como diretórios, e sabemos que para excluir um diretório ocupado usamos <code>rm -r nomedodiretorio</code></p>

<p>O comando <code>rm -rf /</code> remove recursivamente todos os arquivos e diretórios do seu sistema Linux, até a raiz. <ins>NUNCA</ins> o execute.</p>

<h3>Comandos top e uptime - Monitoramento e Performance de Sistemas Linux</h3>

<p>O comando <code>top</code> fornece uma visão em tempo real do sistema em execução. Essas são as opções dele:</p>

<ul>
    <li><code>-d atraso</code>: Especifica o atraso em segundos entre atualizações de tela. O padrão é 5 segundos.</li>
    <li><code>-i</code>: Ignora processos ociosos.</li>
    <li><code>-n num</code>: Exibe num iterações e depois termina.</li>
    <li><code>-b</code>: Roda em modo de batch. Útil para mandar a saída de top para outros programas ou um arquivo.</li>
</ul>

<p>Digite esses comandos:</p>

<pre>
<code>
top # Modo interativo, use q para sair

top -i # Ignora processos ociosos

top -n 3 # Roda 3 vezes
</code>
</pre>

<p>As opções do modo interativo são essas:</p>

<ul>
    <li><code>h</code>: Gera uma tela de ajuda.</li>
    <li><code>k</code>: Termina um processo (será pedido seu PID).</li>
    <li><code>q</code>: Sai do programa.</li>
    <li><code>r</code>: Mofifica a prioridade de um processo (renice). Serão pediso seu PID e valor nic (valores positivos tem menos prioridade).</li>
    <li><code>s</code>: Modifica o atraso em segundos entre as atualizações. Será pedido o tempo em segundos.</li>
</ul>

<p>Descrição dos campos de TOP:</p>

<ul>
    <li><b>PID</b>: O PID de cada processo.</li>
    <li><b>USER</b>: Usuário proprietário do processo.</li>
    <li><b>PR</b>: Prioridade da tarefa.</li>
    <li><b>NI</b>: Valor nice da tarefa.</li>
    <li><b>VIRT</b>: Memória virtual usada pelo processo.</li>
    <li><b>RES</b>: Memória física usada pelo processo.</li>
    <li><b>SHR</b>: Memória compartilhada usada pelo processo.</li>
    <li><b>S</b>: Estado da tarefa (S = sleeping, R = running, T = stopped, Z = zombie, etc.).</li>
    <li><b>%CPU</b>: Porcentagem de tempo de CPU usada pela tarefa.</li>
    <li><b>%MEM</b>: Porcentagem de tempo de memória usada pela tarefa.</li>
    <li><b>TIME+</b>: Tempo total de atividade da tarefa desde que ela foi iniciada.</li>
    <li><b>COMMAND</b>: Nome do processo.</li>
</ul>

<p>O comando <code>uptime</code> mostra o tempo atual, há quanto tempo o sistema está rodando, quantos usuários estão logados atualmente e as médias de carga do sistema nos últimos 1, 5 e 15 minutos. Use apenas <code>uptime</code> no terminal.</p>

<h3>Comandos vmstat e free - Monitoramento e Performance do Sistema Linux</h3>

<p>O comando <code>vmstat</code> reporta informações sobre processos, memória, paginação, blocos de I/O, traps e atividades de CPU. Usa a sintaxe <code>vmstat opções</code>. As opções são essas:</p>

<ul>
    <li><code>-S M</code>: Usa a unidade MB em vez do padrão KB.</li>
    <li><code>-a</code>: Mostra memória ativa e inativa.</li>
    <li><code>-d</code>: Mostra estatísticas de discos.</li>
    <li><code>-p partição</code>: Mostra informações de R/W na partição especificada.</li>
    <li><code>-s</code>: Mostra estatísticas em formato de tabela.</li>
</ul>

<p>Digite esses comandos:</p>

<pre>
<code>
vmstat

vmstat -S M
</code>
</pre>

<p>Os campos do vmstat são esses:</p>

<ul>
    <li><code>procs</code>
        <ul>
            <li><code>r</code>: Nº de processos esperando para rodar.</li>
            <li><code>b</code>: Nº de processos em dormência inininterrupta.</li>
        </ul>
    </li>
    <li><code>memory</code>
        <ul>
            <li><code>swpd</code>: Memória virtual usada.</li>
            <li><code>free</code>: Memória livre.</li>
            <li><code>buff</code>: Memória usada como buffer.</li>
            <li><code>cache</code>: Memória usada com cache.</li>
        </ul>
    </li>
    <li><code>swap</code>
        <ul>
            <li><code>si</code>: Memória trocada a partir do disco.</li>
            <li><code>so</code>: Memória trocada para o disco.</li>
        </ul>
    </li>
</ul>

<p>Digite esses comandos:</p>

<pre>
<code>
vmstat -a

vmstat -d

vmstat -p /dev/sda1

vmstat -s
</code>
</pre>

<p>O comando <code>free</code> exibe a quantidade de memória livre e usada no sistema. Usa-se o comando <code>free opcoes</code>, que são essas:</p>

<ul>
    <li><code>-b</code>: Mostra o uso da memória em bytes.</li>
    <li><code>-k</code>: Idem, em KB.</li>
    <li><code>-m</code>: Idem, em MB.</li>
    <li><code>-t</code>: Exibe uma linha que mostra os totais.</li>
    <li><code>-s n</code>: Operação contínua em intervalos de n segundos.</li>
</ul>

<p>Digite esses comandos:</p>

<pre>
<code>
free

free -b

free -k

free -m

free -t

free -s 1
</code>
</pre>

<h3>Comando iostat e dstat - Monitoramento e Performance do Sistema Linux</h3>

<p>O comando <code>iostat</code> mostra informações sobre o uso da CPU e várias estatísticas sobre E/S do sistema. A sintaxe é <code>iostat opções</code>, que são essas:</p>

<ul>
    <li><code>-c</code>: Mostra apenas estatísticas da CPU.</li>
    <li><code>-d</code>: Mostra apenas estatísticas de I/O de disco.</li>
    <li><code>-p sda</code>: Mostra apenas estatísticas para sda.</li>
</ul>

<p>Digite esses comandos:</p>

<pre>
<code>
iostat -c

iostat -d

iostat -p sda # Não precisa colocar o caminho completo
</code>
</pre>

<p>O comando <code>dstat</code> permite efetuar monitoramento e verificar performance do sistema Linux, possuindo características dos comandos top, vmstat, free e iostat combinadas. Instale ele com <code>sudo apt install dstat</code>. A sintaxe é <code>dstat opções</code>, que são essas:</p>

<ul>
    <li><code>n</code>: No lugar do n, colocamos o intervalo de atualização em segundos.</li>
    <li><code>-m</code>: Estatísticas de uso de memória.</li>
    <li><code>-c</code>: Estatísticas de CPU.</li>
    <li><code>-d</code>: Estatísticas de disco.</li>
    <li><code>-i</code>: Interrupções.</li>
    <li><code>-n</code>: Estatísticas de uso de rede.</li>
    <li><code>--fs</code>: Estatísticas do sistema de arquivos.</li>
</ul>

<p>Digite esses comandos:</p>

<pre>
<code>
dstat

dstat -m

dstat -c

dstat -d

dstat -i

dstat -n

dstat --fs
</code>
</pre>

<p>PS: Temos também uma ferramenta gráfica para o dstat, digitando <code>sudo apt install gnome-system-monitor</code>.</p>

<h3>Como Criar Array RAID por Software no Linux</h3>

<p>RAID é um arranjo redundante de discos independentes. O dispositivo RAID é um dispositivo virtual criado a partir de dois ou mais dispositivos de blocos reais no Linux, como HDs.</p>

<p>A função do RAID é combinar dois ou mais dispositivos em um único dispositivo que contém um sistema de arquivos padrão.</p>

<p>Para configurar o RAID no Linux usamos a ferramenta <code>mdadm</code>, que é usada para administrar conjuntos de multi-dispositivos. Para instalar ele no Debian e derivados use o comando <code>sudo apt install mdadm</code>.</p>

<p>A sintaxe básica do comando é <code>mdadm [modo] [nomearray] [opções] [componentesarray]</code></p>

<p>PS: Para criar o array RAID devemos ter mais de uma partição ou discos no computador. E não mexa nas partições onde o Linux ou outros sistemas estejam instalados, geralmente a <code>/dev/sda</code>. É recomendado usar um sistema em máquina virtual para isso.</p>

<p>Para listar os discos disponíveis, digite <code>sudo fdisk -l</code>.</p>

<p>Os discos a serem usados no exemplo serão <code>/dev/sdb</code> e <code>/dev/sdc</code>.</p>

<p>Primeiramente, crie partições no disco rígido, podemos fazer via linha de comandos digitando esses comandos:</p>

<pre>
<code>
sudo fdisk /dev/sdb

sudo fdisk /dev/sdc
</code>
</pre>

<p>Daí é só seguir as instruções para criar as novas partições. Escolha o tipo fd.</p>

<p>Para criar o array RAID usamos esse comando:</p>

<pre>
<code>
sudo mdadm --create /dev/md0 --verbose --level=1 --raid-device=2 /dev/sdb1 /dev/sdc1

# O md0 é o array RAID, seguido por md1, md2, etc.
# O level 1 é o RAID por espelhamento.
# O raid-device é a quantidade de discos que farão parte do array.
</code>
</pre>

<p>Para ver o status do array use esse comando:</p>

<pre>
<code>
cat /proc/mdstat
</code>
</pre>

<p>Para ver os detalhes do array, digite isso:</p>

<pre>
<code>
sudo mdadm --detail /dev/md0
</code>
</pre>

<p>Para adicionar o array ao arquivo de configuração do mdadm (<code>/etc/mdadm/mdadm.conf</code>):</p>

<pre>
<code>
sudo mdadm -Es | grep md >> /etc/mdadm/mdadm.conf # São dois >> para adicionar, NUNCA use um só >
</code>
</pre>

<p>Para formatar o array, fazemos assim:</p>

<pre>
<code>
sudo mkfs.ext4 /dev/md0
</code>
</pre>

<p>Para montar o array, montamos como um disco comum, assim:</p>

<pre>
<code>
sudo mkdir /raid

sudo mount -t ext4 /dev/md0 /raid

df -h # Para verificar o ponto de montagem
</code>
</pre>

<h3>RAID por Software o Linux - Simular Falhas, Reparar e Destruir Array</h3>

<p>Para verificar o status do array, usamos esse comando:</p>

<pre>
<code>
sudo mdadm --detail /dev/md0

# Ou também:

cat /proc/mdstat
</code>
</pre>

<p>Para simular uma falha no array:</p>

<pre>
<code>
mdadm --manage --set-faulty /dev/md0 /dev/sdc1
</code>
</pre>

<p>Vamos remover e colocar um novo <q>disco</q> no lugar do <q>defeituoso</q>:</p>

<pre>
<code>
sudo mdadm /dev/md0 -r /dev/sdc1

sudo mdadm /dev/md0 -a /dev/sdc1

sudo mdadm --detail /dev/md0 # Dê alguns segundos e rode este comando novamente, pode levar horas, dependendo do tamanho do disco
</code>
</pre>

<p>Para excluir esse array, fazemos assim:</p>

<pre>
<code>
sudo mdadm --stop /dev/md0

sudo mdadm --remove /dev/md0

sudo mdadm --zero-superblock /dev/sd[bc]1 # O que está entre [] é uma expressão regular

mdadm --detail /dev/md0

cat /proc/mdstat

sudo fdisk /dev/sdb # Use as opções d e p para excluir as partições.
</code>
</pre>

<h3>RAID 5 no Linux - Configuração e Adição ao FSTAB</h3>

<p>O RAID 5 tem ao menos três discos e funciona armazenando os dados distribuídos pelos discos com informações de paridade, que são bits que são armazenados em cada um dos discos, que permitem a recuperação de dados caso algum dos discos tenham algum problema.</p>

<p>No nosso exemplo teremos 3 discos, <code>/dev/sdb</code>, <code>/dev/sdc</code> e <code>/dev/sdd</code>.</p>

<p>Primeiro vamos criar partições específicas para RAID nos discos:</p>

<pre>
<code>
sudo fdisk -l

sudo fdisk /dev/sdb # Use as opções d e p para excluir as partições, e n e t para recriar as mesmas

sudo fdisk /dev/sdc # Mesmo caso acima

sudo fdisk /dev/sdd # Só crie a partição

sudo fdisk -l
</code>
</pre>

<p>Crie a matriz RAID 5:</p>

<pre>
<code>
sudo mdadm --create --force --assume-clean /dev/md0 --verbose --level=5 --raid-devices=3 /dev/sd[bcd]1

cat /etc/mdadm/mdadm.conf
</code>
</pre>

<p>Para adicionar o array ao arquivo de configuração mdadm.conf:</p>

<pre>
<code>
sudo mdadm -Es | grep md >> /etc/mdadm/mdadm.conf # São dois >>
</code>
</pre>

<p>Para formatar o array:</p>

<pre>
<code>
sudo mkfs.ext4 /dev/md0

sudo mkdir /raid # Crie caso nã otenha criado anteriormente

# Para montar o dispositivo:

sudo mount -t ext4 /dev/md0 /raid

# Informações:

df -h

sudo mdadm --detail /dev/md0
</code>
</pre>

<p>Para usar o array depois de reinicalizar o computador, faça isso para montar ele automaticamente:</p>

<pre>
<code>
sudo blkid # Para descobrir o UUID do array

sudo nano /etc/fstab
</code>
</pre>

<p>No arquivo fstab, adicione essas linhas:</p>

<pre>
<code>
# RAID 5
uUID=c9a487ed-032b-48a9-b4ef-b8a6db93ea74   /raid   ext4    defaults    0   0
</code>
</pre>

<p>Reinicialize a máquina, veja que nas mensagens da inicialização aparecerá os discos criados pelo RAID.</p>

<ul>
    <li><a href="tudo-sobre-linux-3.html">Parte Anterior da Matéria!</a></li>
    <li><a href="tudo-sobre-linux-5.html">Continuação da Matéria!</a></li>
</ul>

        </div>
    </body>
</html>