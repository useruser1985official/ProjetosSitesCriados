<!DOCTYPE html>
<html lang="pt-br">
    <head>
        <meta charset="UTF-8"/>
        <link rel="icon" href="_imagens/favicon.ico"/>
        <title>Aprenda POO PHP</title>
        <link rel="stylesheet" href="_css/estilo.css"/>
    </head>
    <body>
        <div>
            <header>
                <h1>Aprenda POO PHP</h1>
                <menu>
                    <li><a href="index.html">Página Inicial</a></li>
                    <li><a href="contato.html">Contato!</a></li>
                    <li><a href="tudo-sobre-poo-php-1.html">Tudo sobre POO PHP Parte 1!</a></li>
                    <li><a href="tudo-sobre-poo-php-2.html">Tudo sobre POO PHP Parte 2!</a></li>
                    <li><a href="tudo-sobre-poo-php-3.html" onclick="alert('Você já Está na Matéria desse Link!'); return false">Tudo sobre POO PHP Parte 3!</a></li>
                    <li><a href="tudo-sobre-poo-php-4.html">Tudo sobre POO PHP Parte 4!</a></li>
                    <li><a href="tudo-sobre-poo-php-5.html">Tudo sobre POO PHP Parte 5!</a></li>
                    <li><a href="tudo-sobre-poo-php-6.html">Tudo sobre POO PHP Parte 6!</a></li>
                    <li><a href="tudo-sobre-poo-php-7.html">Tudo sobre POO PHP Parte 7!</a></li>
                </menu>
            </header>
            
<h2>Tudo sobre Poo PHP Parte 3</h2>

<h3>Objetos Compostos em PHP</h3>

<p>Para fazermos um relacionamento entre classes, vamos supor o Objeto lutador, com esses atributos e métodos e suas visibilidades:</p>

<table>
    <tr>
        <th>Lutador</th>
    </tr>
    <tr>
        <td>
            - nome<br/>
            - nacionalidade<br/>
            - idade<br/>
            - altura<br/>
            - peso<br/>
            - categoria<br/>
            - vitórias<br/>
            - derrotas<br/>
            - empates<br/>
        </td>
    </tr>
    <tr>
        <td>
            + apresentar()<br/>
            + status()<br/>
            + ganharLuta()<br/>
            + perderLuta()<br/>
            + empatarLuta()<br/>
        </td>
    </tr>
</table>

<p>Crie uma classe com o nome Lutador.php, com esse código:</p>

<pre>
<code>
class Lutador {
    private $nome;
    private $nacionalidade;
    private $idade;
    private $altura;
    private $peso;
    private $categoria;
    private $vitorias;
    private $derrotas;
    private $empates;
    
    public function apresentar() {
        echo "&lt;p&gt;-------------------------------&lt;/p&gt;";
        echo "&lt;p&gt;CHEGOU A HORA! O lutador " . $this->getNome();
        echo " veio diretamente de " . $this->getNacionalidade();
        echo ", tem " . $this->getIdade() . " anos e pesa " . $this->getPeso() . "Kg.";
        echo "&lt;br/&gt;Ele tem " . $this->getVitorias() . " vitórias, ";
        echo $this->getDerrotas() . " derrotas e " . $this->getEmpates() . " empates.&lt;/p&gt;";
    }
    public function status() {
        echo "&lt;p&gt;-------------------------------&lt;/p&gt;";
        echo "&lt;p&gt;" . $this->getNome() . " é um peso " . $this->getCategoria();
        echo " e já ganhou " . $this->getVitorias() . " vezes, ";
        echo " perdeu " . $this->getDerrotas() . " vezes e ";
        echo " empatou " . $this->getEmpates() . " vezes.&lt;/p&gt;";
        
    }
    public function ganharLuta() {
        $this->setVitorias($this->getVitorias() + 1);
        // $this->vitorias = $this->vitorias + 1;
    }
    public function perderLuta() {
        $this->setDerrotas($this->getDerrotas() + 1);
    }
    public function empatarLuta() {
        $this->setEmpates($this->getEmpates() + 1);
    }
    
    public function __construct($no, $na, $id, $al, $pe, $vi, $de, $em) {
        $this->nome = $no;
        $this->nacionalidade = $na;
        $this->idade = $id;
        $this->altura = $al;
        $this->setPeso($pe);
        $this->vitorias = $vi;
        $this->derrotas = $de;
        $this->empates = $em;
    }
    public function getNome() {
        return $this->nome;
    }

    public function getNacionalidade() {
        return $this->nacionalidade;
    }

    public function getIdade() {
        return $this->idade;
    }

    public function getAltura() {
        return $this->altura;
    }

    public function getPeso() {
        return $this->peso;
    }

    public function getCategoria() {
        return $this->categoria;
    }

    public function getVitorias() {
        return $this->vitorias;
    }

    public function getDerrotas() {
        return $this->derrotas;
    }

    public function getEmpates() {
        return $this->empates;
    }

    public function setNome($nome) {
        $this->nome = $nome;
    }

    public function setNacionalidade($nacionalidade) {
        $this->nacionalidade = $nacionalidade;
    }

    public function setIdade($idade) {
        $this->idade = $idade;
    }

    public function setAltura($altura) {
        $this->altura = $altura;
    }

    public function setPeso($peso) {
        $this->peso = $peso;
        $this->setCategoria();
    }

    private function setCategoria() { // Esse não tem parâmetros
        if($this->peso <= 52.2) {
            $this->categoria = "Inválido";
        }
        else if($this->peso > 52.2 && $this->peso <= 70.3) {
            $this->categoria = "Leve";
        }
        else if($this->peso > 70.3 && $this->peso <= 83.9) {
            $this->categoria = "Médio";
        }
        else if($this->peso > 83.9 && $this->peso <= 120.2) {
            $this->categoria = "Pesado";
        }
        else {
            $this->categoria = "Inválido";
        }
    }

    public function setVitorias($vitorias) {
        $this->vitorias = $vitorias;
    }

    public function setDerrotas($derrotas) {
        $this->derrotas = $derrotas;
    }

    public function setEmpates($empates) {
        $this->empates = $empates;
    }
}
</code>
</pre>

<p>Lembrando que no método construtor, não terá o atributo "categoria", pois ela será calculada automaticamente pelo nosso programa.</p>

<p>E no index, coloque isso:</p>

<pre>
<code>
require_once "Lutador.php";

$l = array(); // Uso de Array em PHP.

$l[0] = new Lutador("Pretty Boy", "França", 30, 1.75, 68.9, 11, 2, 1); // Precisa passar os parâmetros referentes.
$l[1] = new Lutador("Putscript", "Brasil", 29, 1.68, 57.8, 14, 2, 3);
$l[2] = new Lutador("SnapShadow", "EUA", 35, 1.65, 80.9, 12, 2, 1);
$l[3] = new Lutador("Dead Code", "Austrália", 28, 1.93, 81.6, 13, 0, 2);
$l[4] = new Lutador("UFOCobol", "Brasil", 37, 1.70, 119.3, 5, 4, 3);
$l[5] = new Lutador("Nerdaart", "EUA", 30, 1.81, 105.7, 12, 2, 4);

$l[0]->perderLuta();
$l[0]->apresentar();
$l[0]->status();
</code>
</pre>

<p>Nesse caso, um evento dispara outro evento e o segundo automaticamente configura um atributo. As variáveis foram colocadas em um array (que começa sempre com 0). A setCategoria() não pode ser chamada por ser privada.</p>

<p>Teste outros "lutadores", e os outros métodos.</p>

<h3>Agregação entre Objetos em PHP</h3>

<p>Continuando a aula anterior, com os lutadores, usaremos a agregação entre as classes, que é a relação entre uma classe e outra. Veja o diagrama da classe Luta:</p>

<table>
    <tr>
        <th>Luta</th>
    </tr>
    <tr>
        <td>
        - desafiado<br/>
        - desafiante<br/>
        - rounds<br/>
        - aprovada<br/>
        </td>
    </tr>
    <tr>
        <td> 
        + marcarLuta(l1, l2)<br/>
        + lutar()<br/>
        </td>
    </tr>
</table>

<p>No caso, a classe Luta terá atributos e funções que farão a disputas entre eles.</p>

<p>A classe Lutador não será alterada, e o index só deixe a criação dos objetos (lutadores), sem as invocações das funções.</p>

<p>PS: Podemos criar várias classes dentro de um mesmo pacote (arquivo), mas não é recomendado. Dê a preferência de usar classes em arquivos separados pra facilitar o reuso.</p>

<p>Esse é o código da classe Luta.php, que deverá ser criada:</p>

<pre>
<code>
require_once "Lutador.php";

class Luta {
    private $desafiado;
    private $desafiante;
    private $rounds;
    private $aprovada;
    
    public function marcarLuta($l1, $l2) {
        if($l1->getCategoria() === $l2->getCategoria() && $l1 != $l2) {
            $this->aprovada = true;
            $this->desafiado = $l1;
            $this->desafiante = $l2;
        }
        else {
            $this->aprovada = false;
            $this->desafiado = null;
            $this->desafiante = null;
        }
    }
    public function lutar() {
        if($this->aprovada) {
            echo "&lt;### DESAFIADO ###&gt;";
            $this->desafiado->apresentar();
            echo "&lt;### DESAFIANTE ###&gt;";
            $this->desafiante->apresentar();
            $vencedor = rand(0, 2);
            
            switch($vencedor) {
                case 0:
                    // Empate
                    echo "&lt;p&gt;Empate!&lt;/p&gt;";
                    $this->desafiado->empatarLuta();
                    $this->desafiante->empatarLuta();
                    break;
                case 1:
                    // Desafiado Vence
                    echo "&lt;p&gt;" . $this->desafiado->getNome() . " vence!&lt;/p&gt;";
                    $this->desafiado->ganharLuta();
                    $this->desafiante->perderLuta();
                    break;
                case 2:
                    // Desafiante Vence
                    echo "&lt;p&gt;" . $this->desafiante->getNome() . " vence!&lt;/p&gt;";
                    $this->desafiado->perderLuta();
                    $this->desafiante->ganharLuta();
                    break;
                
            }
        }
        else {
            echo "&lt;p&gt;Luta não pode acontecer!&lt;/p&gt;";
        }
    }
    
    public function getDesafiado() {
        return $this->desafiado;
    }

    public function getDesafiante() {
        return $this->desafiante;
    }

    public function getRounds() {
        return $this->rounds;
    }

    public function getAprovada() {
        return $this->aprovada;
    }

    public function setDesafiado($desafiado) {
        $this->desafiado = $desafiado;
    }

    public function setDesafiante($desafiante) {
        $this->desafiante = $desafiante;
    }

    public function setRounds($rounds) {
        $this->rounds = $rounds;
    }

    public function setAprovada($aprovada) {
        $this->aprovada = $aprovada;
    }
}
</code>
</pre>

<p>E no index, basta colocar isso:</p>

<pre>
<code>
require_once "Luta.php"; // Não é necessário colocar também o Lutador.php

$l = array();

$l[0] = new Lutador("Pretty Boy", "França", 30, 1.75, 68.9, 11, 2, 1); // Precisa passar os parâmetros referentes
$l[1] = new Lutador("Putscript", "Brasil", 29, 1.68, 57.8, 14, 2, 3);
$l[2] = new Lutador("SnapShadow", "EUA", 35, 1.65, 80.9, 12, 2, 1);
$l[3] = new Lutador("Dead Code", "Austrália", 28, 1.93, 81.6, 13, 0, 2);
$l[4] = new Lutador("UFOCobol", "Brasil", 37, 1.70, 119.3, 5, 4, 3);
$l[5] = new Lutador("Nerdaart", "EUA", 30, 1.81, 105.7, 12, 2, 4);

$uec01 = new Luta();

$uec01->marcarLuta($l[0], $l[1]);
$uec01->lutar();

$uec01->getDesafiado()->status();
$uec01->getDesafiante()->status();
</code>
</pre>

<p>Agora teste, mudando os números dos arrays para mudar as lutas, pra ver se podem ou não acontecer e etc.</p>

<p>PS: Se houver uma agregação de objetos em classes, use o <code>unset</code> no objeto agregado dentro do destrutor (no caso o objeto Lutador seria destruído no destrutor da classe Luta).</p>

<ul>
    <li><a href="tudo-sobre-poo-php-2.html">Parte Anterior da Matéria!</a></li>
    <li><a href="tudo-sobre-poo-php-4.html">Continuação da Matéria!</a></li>
</ul>
        </div>
    </body>
</html>