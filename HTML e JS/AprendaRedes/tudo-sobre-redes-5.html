<!DOCTYPE html>
<html lang="pt-br">
    <head>
        <meta charset="UTF-8"/>
        <link rel="icon" href="_imagens/favicon.ico"/>
        <title>Aprenda Redes</title>
        <link rel="stylesheet" href="_css/estilo.css"/>
    </head>
    <body>
        <div>
            <header>
                <h1>Aprenda Redes</h1>
                <menu>
                    <li><a href="index.html">Página Inicial</a></li>
                    <li><a href="contato.html">Contato!</a></li>
                    <li><a href="tudo-sobre-redes-1.html">Tudo sobre Redes Parte 1!</a></li>
                    <li><a href="tudo-sobre-redes-2.html">Tudo sobre Redes Parte 2!</a></li>
                    <li><a href="tudo-sobre-redes-3.html">Tudo sobre Redes Parte 3!</a></li>
                    <li><a href="tudo-sobre-redes-4.html">Tudo sobre Redes Parte 4!</a></li>
                    <li><a href="tudo-sobre-redes-5.html" onclick="alert('Você já Está na Matéria desse Link!'); return false">Tudo sobre Redes Parte 5!</a></li>
                    <li><a href="tudo-sobre-redes-6.html">Tudo sobre Redes Parte 6!</a></li>
                    <li><a href="tudo-sobre-redes-7.html">Tudo sobre Redes Parte 7!</a></li>
                    <li><a href="tudo-sobre-redes-8.html">Tudo sobre Redes Parte 8!</a></li>
                    <li><a href="tudo-sobre-redes-9.html">Tudo sobre Redes Parte 9!</a></li>
                    <li><a href="tudo-sobre-redes-10.html">Tudo sobre Redes Parte 10!</a></li>
                    <li><a href="tudo-sobre-redes-11.html">Tudo sobre Redes Parte 11!</a></li>
                    <li><a href="tudo-sobre-redes-12.html">Tudo sobre Redes Parte 12!</a></li>
                    <li><a href="tudo-sobre-redes-13.html">Tudo sobre Redes Parte 13!</a></li>
                </menu>
            </header>
            
<h2>Tudo sobre Redes Parte 5</h2>

<h3>O Que é um Switch</h3>

<p>Um switch é um equipamento de rede que permite interconectar dispositivos em uma rede de computadores, usando comutação de pacotes para receber, processar e encaminhar quadros ao dispositivo de destino.</p>

<p>Vamos entender o que eles fazem:</p>

<ul>
    <li>Utilizam os endereços de hardware (MAC Adress) para processar e encaminhar dados na camada de enlace (nível 2 no modelo OSI).</li>
    <li>Alguns modelos também conseguem processar dados do nivel 3 (camada de rede) ou superiores, incorporando assim algumas funcionalidades de roteamento.</li>
    <li>Um switch que pode operar em mais de uma camada é chamado de Switch Multilayer.</li>
    <li>Gerenciam o fluxo de dados na rede transmitindo uma mensagem recebida apenas para os dispositivos para os quais a mensagem foi enviada.</li>
    <li>O segmento de rede formado pelos dispositivos conectados à um switch é considerado um domínio de broadcast.</li>
    <li>Cada porta do switch é um domínio de colisão separado.</li>
</ul>

<p>A função principal do switch é conectar os dispositivos que estão dentro de uma rede, não confunda com a funcionalidade do roteador (que conecta redes distintas entre si).</p>

<p>O switch é um equipamento concentrador, que encaminha os pacotes para o dispositivo ou grupo de dispositivos de destino, em vez de simplesmente encaminhar os pacotes para todos os nós da rede, como ocorria com os hubs. Aprende os endereços físicos dos nós e os associa às suas portas para uso posterior. Encaminha os quadros para seus destinos usando técnicas como Store and Forward, Cut-through, Fragment Free e Adaptive Switching.</p>

<p>O swiitch cria uma tabela na sua memória denominada SAT (Source Address Table) com os endereços MAC das estações, que estão associados à cada porta. Quando um dispositivo transmite um quadro, o endereço de destino é pesquisado na SAT. Se encontrado o quadro será transmitido diretamente para a porta de destino. Se o endereço não for encontrado na SAT, o switch envia um broadcast perguntado em todas as portas sobre o endereço, e o adiciona a essa tabela.</p>

<p>Esses são os métodos de encaminhamento:</p>

<ul>
    <li><b>Store and Forward: </b>O switch armazena em buffer os dados e verifica cada quadro antes de encaminhá-lo, um quadro é recebido totalmente antes de ser encaminhado.</li>
    <li><b>Cut-through: </b>O switch inicia o encaminhamento logo após o endereço de destino quadro ter sido recebido. Não há verificação de erros neste métodos.</li>
    <li><b>Fragmente Free (Modified Cut-through): </b>Neste método os primeiros 64 bytes do quadro onde a informação de endereçamento é armazenada, são verificados. De acordo com as especificações Ethernet, as colisões devem ser detectadas durante os primeiros 64 bytes do quadro, de modo que quadros que possuam erros devido à colisões não devem ser encaminhados.</li>
    <li><b>Adaptive Switching:</b>Neste método é realizada uma seleção automática entre os outros três modos.</li>
</ul>

<p>Essa é a classificação quanto à configuração:</p>

<ul>
    <li><b>Não-Gerenciável: </b>Sem opções ou interfaces de configuração. Geralmente usados em pequenos ambientes SOHO.</li>
    <li><b>Gerenciável: </b>Possuem opções para alterar o modo de funcionamento do dispositivo. Podem usar interfaces de linha de comandos, web, ssh, console serial ou outros métodos de acesso, permitem alterar configurações tais como: Habilitar protocolo Spanning Tree, Port Mirroring, configurar largura de banda das portas, aplicar filtros de MAC, criar VLANs, entre diversas outras.</li>
</ul>

<p>Podemos também classificar um switch de acordo com a sua aplicação e o tipo de local onde será utilizado:</p>

<ul>
    <li><b>Desktop: </b>Switches de pequeno porte, 4 a 24 portas, sem gerenciamento, para conexão de estações.</li>
    <li><b>Workgroup (Edge): </b>Capacidade maior de tráfego, conecta workstations à rede, e pode ser gerenciável.</li>
    <li><b>Enterprise (Core): </b>Conecta os switches workgroup e servidores de rede. Alta capacidade de transmissão e altamente gerenciáveis.</li>
    <li><b>Campus: </b>Interliga grandes extensões da rede, como prédios próximos e interligações com concessionárias de serviços.</li>
</ul>

<h3>Escopos de Rede</h3>

<p>O escopo de uma rede refere-se ao seu tamanho ou alcance geográfico. O tamanho de uma rede pode variar de apenas alguns poutos metros, ligando periféricos a um computador, à milhares de computadores conectados a longas distâncias. Os principais tipos de redes quanto ao escopo podem ser LAN, MAN, WAN e PAN.</p>

<p>A LAN, Rede de Área Local, ou simplesmente Rede Local, geralmente está localizada em um edifício, escritório, campus ou mesmo em sua residência. Possuí conectivdade em alta velocidade e sua característica principal é ser uma rede privativa, ou seja, alguém (pessoa ou organização) controla essa rede e o acesso a ela, em uma área geográfica limitada.</p>

<p>As principais tecnologias para redes LAN são o Ethernet e o IEEE 801.11 (WLAN - Rede Wireless Local). É um dos escopos de rede mais populares e comuns.</p>

<p>Uma LAN tem um dispositivo central (switch), que interliga vários dispositivos, como computadores, impressoras, servidores e etc.</p>

<p>A MAN, Rede de Área Metropolitana, é um escopo de rede intermediário entre uma LAN e uma WAN. Trata-se de uma rede localizada em uma área geográfica confinada e bem definida, de tamanho médio, como por exemplo em um município ou região metropolitana. Também existes redes MAN Wireless (sem fio), como no caso das redes WiMAX.</p>

<p>Um bom exemplo de MAN são as redes de TV a Cabo, que conecta vários prédios, casas e relacionados, cada um com sua LAN.</p>

<p>A WAN, Rede de Área Ampla, a comunicação se dá em uma distância relativamente (ou muito) longa. Geralmente podemos usar uma WAN para conectar uma LAN em um local a outra LAN em um local remoto, que pode estar localizada em um prédio vizinho ou do outro lado do planeta.</p>

<p>Um exemplo é ver a WAN como uma "nuvem", que seria a internet, por exemplo. Um modem de banda lagar costuma ter as portas LAN e WAN.</p>

<p>A PAN, Rede de Área Pessoal, é um escopo de rede que remete a equipamentos conectados a um computador, sendo considerada uma espécie de rede privada, consistindo em elementos que se conectam usando tecnologias variadas, como cabos USB, bluetooth, IR (infravermelho) e NFC (Near Field Communication). Conectandos mouses, teclados HDs externos, fones de ouvido wireless, celulares, etc., e sua principal característica é o espaço geográfico extremamente limitado da rede, geralmente alguns poucos metros.</p>

<p>Além dos escopos citados, existem outras classificações de redes menos utilizadas, como o CAN (Campus Area Network), GAN (Global Area Network), HAN (Home Area Network) e SAN (Storage Area Network).</p>

<h3>Protocolo UDP</h3>

<p>O protocolo UDP, que pertence à camada de transporte juntamente com o protocolo TCP, é um protocolo simples, orientado a datagrama. Ele não fornece confiabilidade na transmissão, pois envia os datagramas requisitados pela aplicação sem nenhuma garantia de que eles chegarão ao seu destino.</p>

<p>O UDP não estabelece conexões antes de enviar dados, apenas os empacota em datagramas e os envia. Além disso, não fornece confirmação da entrega de dados.</p>

<p>O protocolo UDP encontra inúmeras aplicações em comunicação de redes, como podemos ver na tabela abaixo:</p>

<table>
    <tr>
        <th>Protocolo</th>
        <th>Porta</th>
        <th>Aplicação</th>
    </tr>
    <tr>
        <td>DNS</td>
        <td>53</td>
        <td>Sistema de resolução de nomes de domínio</td>
    </tr>
    <tr>
        <td>DHCP</td>
        <td>67/68</td>
        <td>Protocolo de configuração de hosts dinâmicos</td>
    </tr>
    <tr>
        <td>SNMP</td>
        <td>161/162</td>
        <td>Protocolo para gerenciamento de redes</td>
    </tr>
    <tr>
        <td>RIP</td>
        <td>520/521</td>
        <td>Protocolo de roteamento que não requer conexões</td>
    </tr>
</table>

<p>O UDP encontra uso em streaming de áudio e vídeo, VoIP, gaming, mecanismos de broadcast e conexões VPN (openVPN, por exemplo), entre outras.</p>

<p>Um segmentos UDP é encapsulado em um datagrama IP, conforme podemos ver na figura a seguir :</p>

<img src="_imagens/encapsulamento-udp.jpg" alt="Encapsulamento UDP"/>

<p>Apesar do UDP não ser tão seguro e confiável, ele é mais rápido, em alguns casos é preferível usar ele ao invés de TCP.</p>

<p>Podemos ver o formato completo de um cabeçalho UDP, cujo tamanho é de 8 bytes:</p>

<table>
    <tr>
        <td>Número de Porta de Origem</td>
        <td>Número de Porta de Destino</td>
    </tr>
    <tr>
        <td>Comprimento</td>
        <td>Checksum</td>
    </tr>
    <tr>
        <td colspan="2">Dados</td>
    </tr>
</table>

<p>No exemplo acima, apenas os dados não fazem parte do cabeçalho UDP. 0 do lado direito, 15 e 16 no meio e 31 no final.</p>

<p>Abaixo, veja os campos do cabeçalho:</p>

<ul>
    <li><b>Número de Porta de Origem: </b>Número que identifica a aplicação (processo) que envia os dados.</li>
    <li><b>Número de Porta de Destino: </b>Número que identifica a aplicação (processo) que deve receber os dados.</li>
    <li><b>Comprimento: </b>Este é um campo que especifica o comprimento em bytes do campo UDP mais os dados carregados. O tamanho mínimo é de 8 bytes devido ao comprimento do cabeçalho. O tamanho máximo possível para um datagrama UDP é de 65.507 bytes (65535 - 8 bytes do cabeçalho UDP - 20 bytes do cabbeçalho IP), devido ao protocolo IPv4. Em IPv6 é possível termos pacotes maiores do que 65535.</li>
    <li><b>Checksum: </b>Pode ser usado para verificação de erros do cabeçalho e dos dados transmitidos. É opcional em IPv4 e obrigatório em IPv6. Se não for usado, deve ser preenchido com zeros.</li>
</ul>

<p>Veja abaixo a comparação dos protocolos TCP e UDP:</p>

<ul>
    <li>O UDP não é confiável, as mensagens enviadas podem não alcançar o destino, o TCP trata disso tentando garantir a entrega da mensagem ao destino.</li>
    <li>O UDP não ordena os datagramas enviados, se chegarem fora de ordem não serão reordenados, o TCP os reordena no destino, caso cheguem deordenados.</li>
    <li>O UDP é um protocolo mais leve, pois não realiza handshake para estabelecer e finalizar conexões nem tampouco mantém registro das conexões ativas, o TCP realiza essas tarefas.</li>
    <li>Coomo o UDP não é orientado à conexão, ele pode enviar pacotes em broadcast ou multicast tranquilamente, o TCP é projetado para trabalhar em comunicação unicast.</li>
</ul>

<h3>APIPA - Endereço de Configuração IP Automática</h3>

<p>Quando a gente utiliza o endereçamento IPv4 numa rede, devemos configurar os IPs nas estações de trabalho, isso podemos fazer manualmente ou utilizar um servidor DHCP para atribuir os endereços de forma automática. Porém, pode acontecer do servidor DHCP falhar ou não estar disponível na rede, ou ainda a sua estação não conseguir contactar o servidor DHCP para pegar a configuração de IP automática. Nesse caso, para tentar garantir que as estações consigam se comunicar entre si dentro da própria rede local, existe o esquema chamado APIPA (Endereçamento de IP Privado Automático), assim podemos garantir que as máquinas consigam se comunicar na rede local mesmo que não haja um servidor DHCP disponível para atribuir um endereço host naquele momento.</p>

<p>A ideia do APIPA é essa abaixo:</p>

<ul>
    <li>Endereço de configuração automática do Windows.</li>
    <li>Atribui automaticamente IP à uma estação caso haja falha na comunicação com um servidor DHCP.</li>
    <li>Garante a comunicação entre as estações dentro de uma rede.</li>
</ul>

<p>Há uma faixa de endereços reservados pelos IETF que são atribuídas pelo APIPA, de <code>169.254.0.1</code> até <code>169.254.255.254</code>.</p>

<p>O primeiro e o último bloco dessa faixa são reservados, de modo que as estações, na verdade, irão receber endereços localizados entre <code>169.254.1.0</code> até <code>169.254.254.255</code>.</p>

<p>A máscara de sub-rede é 255.255.0.0 (classe B).</p>

<p>Além de ser um indicativo de que não há conectividade com o servidor DHCP em uma rede, o APIPA pode ajudar a detectar variados problemas, como:</p>

<ul>
    <li>Patch cable defeituoso.</li>
    <li>Servidor DHCP com problemas.</li>
    <li>Sem conexão adequada à rede sem fio.</li>
    <li>Cabeamento fixo com problemas.</li>
    <li>Problemas em uma ou mais portas do switch.</li>
</ul>

<p>Ou seja, problemas que, em última instância, levem à quebra de comunicação entre as estações e o servidor DHCP da rede.</p>

<p>Abra o CMD e digite <code>ipconfig</code> para vermos a configuração atual de IP.</p>

<p>Para liberar a configuração de IP, use <code>ipconfig /release</code>, aí ele mostrará o IP de configuração automática em ação (169.254.x.x). Para renovar, use o <code>ipconfig /renew</code>.</p>

<p>Para abrir as conexões de rede, digite <code>ncpa.cpl</code>. Lá dentro, clique com o botão direito em Conexão Local, e em IPv4, lá terá a opção Configuração Alternativa, que é referente ao APIPA, onde podemos configurar também manualmente.</p>

<h3>Ipconfig - Utilitário para Diagnóstico de rede no Windows</h3>

<p>O ipconfig, usado no CMD, tem a finalidade de trazer, basicamente, as configurações atuais de rede que sua máquina está usando. Mas ele também pode ser usado para outras taferas, como mostrar o conteúdo do cache do resolvedor DNS, ou ainda fazer a renovação de uma concessão de endereço obtido via DHCP, ou ainda liberar esse endereço, entre outras coisas.</p>

<p>Essas são as principais funções do ipconfig:</p>

<table>
    <tr>
        <th>Opção</th>
        <th>Significado</th>
    </tr>
    <tr>
        <td>/?</td>
        <td>Mostra a ajuda do comando</td>
    </tr>
    <tr>
        <td>/all</td>
        <td>Mostra informações de configuração de rede completas</td>
    </tr>
    <tr>
        <td>/release</td>
        <td>Libera os endereços IP associados a um adaptador especificado.</td>
    </tr>
    <tr>
        <td>/renew</td>
        <td>Renova os endereços IP associados a um adaptador especificado.</td>
    </tr>
    <tr>
        <td>/release6</td>
        <td>Libera os endereços IPv6 associados a um adaptador especificado.</td>
    </tr>
    <tr>
        <td>/renew6</td>
        <td>Renova os endereços IPv6 associados a um adaptador especificado.</td>
    </tr>
    <tr>
        <td>/flushdns</td>
        <td>Limpa o cache do resolvedor DNS</td>
    </tr>
    <tr>
        <td>/registerdns</td>
        <td>Atualiza todas as concessões DHCP e registra novamente os nomes DNS</td>
    </tr>
    <tr>
        <td>/displaydns</td>
        <td>Mostra o conteúdo do cache do resolvedor DNS</td>
    </tr>
    <tr>
        <td>/showclassid</td>
        <td>Mostra todas as identificações de classe DHCP permitidas para o adaptador especificado</td>
    </tr>
    <tr>
        <td>/setclassid</td>
        <td>Permite modificar as identificações de classe DHCP</td>
    </tr>
</table>

<p>PS: Digitar apenas ipconfig mostrará as informações de configuração de rede resumida.</p>

<p>Em Linux, os equivalentes aou ipconfig /release, ipconfig /renew e ipconfig /all, são respectivamente, <code>ifconfig eth0 down</code>, <code>ifconfig eth0 up</code> (ambos substituindo pela interface, descoberta pelo ifconfig sozinho) e <code>ifconfig -a</code> (atenção que em Linux é ifconfig), qualquer dúvida é só ver a ajuda usando <code>ifconfig --help</code>.</p>

<h3>Fragmentação de Pacotes IP</h3>

<p>Quando um roteador recebe um pacote, ele examina o endereço de destino e determina para qual interface deve encaminhar esse pacote, para que possa seguir seu caminho até o destino.</p>

<p>Além disso, o roteador também determina o MTU da interface a ser usada. Caso o tamanho do pacote seja maior do que o MTU, e o bit DF do campo Flag do cabeçalho esteja ajustado em 0, o roteador irá fragmentar o pacote.</p>

<p>O propósito da fragmentação de pacotes IP, realizada pelo protocolo IP, é portanto permitir que os datagramas possam ser transmitidos em link cujo MTU seja menor do que o tamanho original desses datagramas.</p>

<p>Fragmentar o pacote significa dividir o pacote em unidades de menor tamanho, denominadas fragmentos. O tamanho máximo de um fragmento é o tamanho da MTU menos o tamanho do cabeçalho IPv4, que pode variar de 20 a 60 bytes.</p>

<p>Cada fragmento será enviado pela rede em um pacote separado, e cada um desses pacotes seguirá algumas regras específicas.</p>

<p>Essas são as regras da fragmentação de datagramas:</p>

<ul>
    <li>O campo tamanho total será o tamanho do fragmento.</li>
    <li>O bit MF (More Fragments) no campo flags será configurado em 1 para todos os fragmentos exceto o último, que terá o valor 0 ajustado.</li>
    <li>O campo offset do fragmento será configurado (em 1), baseado no deslocamento do fragmento no campo de dados original, em blocos de 8 bytes.</li>
    <li>O checksum do cabeçalho deve ser recalculado.</li>
</ul>

<p>Assim, se tivermos um MTU de 1500 bytes e pacotes padrão com cabeçalho de 20 bytes, os offsets (deslocamentos) dos ffragmentos serão múltiplos de (1500 - 20) / 8 = 185, como por exemplo, 0, 185, 370, etc.</p>

<p>Veja abaixo o formato do cabeçalho IPv4:</p>

<img src="_imagens/cabecalho-ipv4.jpg" alt="Cabeçalho IPv4"/>

<p>Vamos supor que um segmento da camada de transporte tenha um tamanho total de 4000 bytes, sem o uso de opções, e que esse segmento será enviado em pacotes IP de cabeçalho padrão de 20 bytes.</p>

<p>O tamanho total do pacote IP gerado teria então 4020 bytes (4000 + 20). Vamos assumir também o caso típico do envio desse pacote por um link cujo MTU é de 1500 bytes. O pacote seria fragmentado da seguinte forma:</p>

<table>
    <tr>
        <th>Fragmento</th>
        <th>Bytes de Dados</th>
        <th>Bytes do Cabeçalho</th>
        <th>Bytes Totais</th>
        <th>Flag MF</th>
        <th>Offset do Fragmento</th>
    </tr>
    <tr>
        <td>1</td>
        <td>1480</td>
        <td>20</td>
        <td>1500</td>
        <td>1</td>
        <td>0</td>
    </tr>
    <tr>
        <td>2</td>
        <td>1480</td>
        <td>20</td>
        <td>1500</td>
        <td>1</td>
        <td>185</td>
    </tr>
    <tr>
        <td>3</td>
        <td>1040</td>
        <td>20</td>
        <td>1060</td>
        <td>0</td>
        <td>370</td>
    </tr>
</table>

<p>O primeiro offset será igual a zero, o segundo offset será igual a 0 + (bytes de dados / 8) = 0 + 1480 / 8 = 185, e o terceiro offset será igual ao segundo offset (185) + (bytes de dados / 8) = 185 + 1480 / 8 = 185 + 185 = 370.</p>

<p>Ao chegar no receptor, ele fará a remontagem dos dados fragmentados, igual estava antes.</p>

<p>Podemos recalcular o tamanho total do pacote a partir do offset do último fragmento e do tamanho em bytes de seus dados, da seguinte forma:</p>

<pre>
<code>
tamanho_total = offset * 8 + bytes_de_dados;

// Em nosso exemplo:

tamanho_total = 370 * 8 + 1040 = 2960 + 1040 = 4000;
</code>
</pre>

<p>Quando os pacotes chegam a seu destino, eles devem ser remontados para que possam ser processados.</p>

<p>O receptor sabe que um pacote é um fragmento caso o flag MF esteja ativo, e caso o campo offset do fragmento possuma um valor diferente de zero.</p>

<p>Fragmentos que possuam a mesma identificação pertencem ao mesmo pacote, e o campo offset do fragmento permite ordenar esses fragmentos.</p>

<p>Após a remontagem, o pacote é enviado para a camada de núvel superior na pilha de protocolos (camada de transporte) para processamento.</p>

<ul>
    <li><a href="tudo-sobre-redes-4.html">Parte Anterior da Matéria!</a></li>
    <li><a href="tudo-sobre-redes-6.html">Continuação da Matéria</a></li>
</ul>

        </div>
    </body>
</html>