<!DOCTYPE html>
<html lang="pt-br">
    <head>
        <meta charset="UTF-8"/>
        <link rel="icon" href="imagens/favicon.ico"/>
        <title>Aprenda Pandas</title>
        <link rel="stylesheet" href="css/estilo.css"/>
    </head>
    <body>
        <div>
            <header>
                <h1>Aprenda Pandas</h1>
                <menu>
                    <li><a href="index.html">Página Inicial</a></li>
                    <li><a href="contato.html">Contato!</a></li>
                    <li><a href="tudo-sobre-pandas-1.html">Tudo sobre Pandas Parte 1!</a></li>
                    <li><a href="tudo-sobre-pandas-2.html" onclick="alert('Você já Está na Matéria desse Link!'); return false">Tudo sobre Pandas Parte 2!</a></li>
                </menu>
            </header>
            
<h2>Tudo sobre Pandas Parte 2</h2>

<h3>Comando Loc para Dataframes MultiIndex</h3>

<p>Podemos usar o loc dessa forma também, para pegar múltiplos índices (no caso, dois) de uma coluna:</p>

<pre>
<code>
print(dfNotif.loc[("Brazil", "12/14/20"), :])
</code>
</pre>

<p>Para pegar todas as datas atribuídas ao Brasil:</p>

<pre>
<code>
print(dfNotif.loc["Brazil", :])
</code>
</pre>

<p>Caso queira pegar mais de um país:</p>

<pre>
<code>
print(dfNotif.loc[(("Brazil", "US"), "12/14/20"), :])
</code>
</pre>

<p>E também mais de uma data:</p>

<pre>
<code>
print(dfNotif.loc[(("Brazil", "US"), ("12/14/20", "12/14/21")), :])
</code>
</pre>

<p>E um intervalo de datas:</p>

<pre>
<code>
print(dfNotif.loc[("Brazil", "12/14/20") : ("Brazil", "12/14/21")])
</code>
</pre>

<h3>Comando reset_index</h3>

<p>Para a gente voltar pros índices anteriores, podemos fazer assim:</p>

<pre>
<code>
print(dfNotif.reset_index())    
</code>
</pre>

<p>Esse comando acima reseta tudo que foi feito no código.</p>

<p>Podemos resetar por level (coluna), por exemplo, contando a partir do 0:</p>

<pre>
<code>
print(dfNotif.reset_index(level = 0))
</code>
</pre>

<p>E com o 1:</p>

<pre>
<code>
print(dfNotif.reset_index(level = 1))
</code>
</pre>

<p>Para ver os tipos dos dados resetados:</p>

<pre>
<code>
dfNotif.reset_index(inplace = True)

print(dfNotif.dtypes)
</code>
</pre>

<p>Só que veja que datas é identificado como object, ele deveria ser identificado como datetime. Para converter, faça assim:</p>

<pre>
<code>
dfNotif["Datas"] = pd.to_datetime(dfNotif["Datas"], format = "%m/%d/%y")

print(dfNotif.dtypes)
</code>
</pre>

<p>Depois, é só retirar o dtypes e mostrar o print puro, assim:</p>

<pre>
<code>
print(dfNotif)
</code>
</pre>

<h3>Comando Pivot</h3>

<p>Para transformar o dado para que possamos utilizar, podemos usar o método pivot.</p>

<p>No caso, podemos fazer de uma coluna um novo index, por exemplo, entre outras coisas. É uma forma de estruturar as colunas.</p>

<p>Vamos fazer assim:</p>

<pre>
<code>
print(dfNotif.pivot(index = "Datas", columns = "País/Região", values = "Notificações"))
</code>
</pre>

<p>No caso acima, as datas vão ser os índices e cada país será uma coluna.</p>

<p>E para definir um plot:</p>

<pre>
<code>
dfNotif = dfNotif.pivot(index = "Datas", columns = "País/Região", values = "Notificações")

print(dfNotif.plot(y = "Brazil", use_index = True, grid = True, figsize = (12, 8)))

plt.show() # Coloque import matplotlib.pyplot as plt
</code>
</pre>

<p>PS: Instale a biblioteca matplotlib antes e importe ela. Ela é pra gerar gráficos.</p>

<p>Com uma lista de países:</p>

<pre>
<code>
dfNotif.plot(y = ["Brazil", "US", "Italy", "China"], use_index = True, grid = True, figsize = (12, 8))

plt.show() # Coloque import matplotlib.pyplot as plt
</code>
</pre>

<h3>Resumo</h3>

<p>Resumidamente, o que fizemos inicialmente foi isso:</p>

<pre>
<code>
import pandas as pd

link = "https://raw.githubusercontent.com/CSSEGISandData/COVID-19/refs/heads/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_global.csv"

dfNotif = pd.read_csv(link)

dfNotif.drop(["Lat", "Long"], axis = 1, inplace = True)

print(dfNotif)
</code>
</pre>

<p>Agrupando somando:</p>

<pre>
<code>
dfNotif = dfNotif.groupby(by = ["Country/Region"]).sum()

print(dfNotif)
</code>
</pre>

<p>Invertendo linhas e colunas com a opção <q>T</q>:</p>

<pre>
<code>
dfNotif = dfNotif.T

print(dfNotif)
</code>
</pre>

<p>Personalizando nome de uma das colunas:</p>

<pre>
<code>
dfNotif.index.set_names(("Datas"), inplace = True)

print(dfNotif)
</code>
</pre>

<p>Exibindo os índices:</p>

<pre>
<code>
print(dfNotif.index)
</code>
</pre>

<h3>Comando Merge</h3>

<p>Defina essas linhas no código, no lugar do print dfNotif:</p>

<pre>
<code>
link = "https://raw.githubusercontent.com/CSSEGISandData/COVID-19/refs/heads/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_global.csv"

dfDeaths = pd.read_csv(link)

dfDeaths.drop(["Lat", "Long"], axis = 1, inplace = True)

dfDeaths = dfDeaths.groupby(by = ["Country/Region"]).sum()

dfDeaths = dfDeaths.T

dfDeaths.index.set_names("Datas", inplace = True)

print(dfDeaths)
</code>
</pre>

<p>E no lugar do último print acima:</p>

<pre>
<code>
dfDeaths.plot(y = ["Brazil", "US", "Italy", "China"], use_index = True, grid = True, figsize = (12, 8), logy = True)

plt.show()
</code>
</pre>

<p>O merge, basicamente, ele funde dois dataframes em apenas um só. No caso, colocaremos o notifications na esquerda e o deaths na direita.</p>

<p>Faça assim no final do código, antes do plot:</p>

<pre>
<code>
dfNotif.merge(dfDeaths, on = "Datas", how = "left", sort = True)
</code>
</pre>

<p>No lugar do plot e do plt, abaixo do merge:</p>

<pre>
<code>
brNotif = dfNotif[["Brazil"]]

brNotif.columns = ["Notifications"]

print(brNotif)
</code>
</pre>

<p>O mesmo com o deaths:</p>

<pre>
<code>
brDeaths = dfDeaths[["Brazil"]]

brDeaths.columns = ["Deaths"]

print(brDeaths)
</code>
</pre>

<p>E ao fundir, deixe apenas esse print, tirando o merge anterior pra não dar conflitos:</p>

<pre>
<code>
brNotif.merge(brDeaths, on = "Datas", how = "left", sort = True)

print(brNotif)
</code>
</pre>

<p>Fazendo o fatiamento, retirando os dois primeiros índices de brNotif e os dois últimos de brDeaths:</p>

<pre>
<code>
brNotif.iloc[2:, :].merge(brDeaths.iloc[:-2, :], on = "Datas", how = "left", sort = True)

print(brNotif)
</code>
</pre>

<p>Isso é pra remover as ocorrencias com <q>NaN</q>.</p>

<p>Troque o <q>left</q> de merge por <q>right</q>. Pra ele não privilegiar nem o da direita nem o da esquerda, fazendo uma junção geral, coloque <q>outer</q>.</p>

<ul>
    <li><a href="tudo-sobre-pandas-1.html">Parte Anterior da Matéria!</a></li>
    <!--<li><a href="tudo-sobre-pandas-3.html">Continuação da Matéria!</a></li>-->
</ul>
        </div>
    </body>
</html>